C51 COMPILER V9.56.0.0   OLED                                                              04/06/2018 12:37:06 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\oled.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Lib\src\oled.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..
                    -\Lib;..\Lib\inc;..\Lib\src;..\sourses) DEBUG OBJECTEXTEND PRINT(.\Listings\oled.lst) TABS(2) OBJECT(.\Objects\oled.obj)

line level    source

   1          #include "oled.h"
   2          
   3          
   4          
   5          
   6          void delay()
   7          {
   8   1          int i;
   9   1          for(i=0;i<3000;i++)
  10   1          {
  11   2              _nop_();
  12   2              _nop_();
  13   2              _nop_();
  14   2              _nop_(); 
  15   2          }
  16   1      
  17   1      }
  18          
  19          
  20          
  21          void OLED_WR_Byte(unsigned char Data,bit CD) 
  22          {
  23   1          if(CD)
  24   1          {
  25   2              // IIC_Start();
  26   2              // IIC_WR_Byte(0x78);     //D/C#=0; R/W#=0
  27   2          //    SCL=1;
  28   2          //    SCL=0;
  29   2              // IIC_WR_Byte(0x40);     //write data
  30   2          //    SCL=1;
  31   2          //    SCL=0;
  32   2              // IIC_WR_Byte(Data);
  33   2          //    SCL=1;
  34   2          //    SCL=0;
  35   2              // IIC_Stop();
  36   2      
  37   2          OBIIC_Start();
  38   2          OBIIC_SendData(0x78);
  39   2          OBIIC_RecvACK();
  40   2          OBIIC_SendData(0x40);
  41   2          OBIIC_RecvACK();
  42   2          OBIIC_SendData(Data);
  43   2          OBIIC_RecvACK();
  44   2          OBIIC_Stop();
  45   2      
  46   2      
  47   2      
  48   2          }
  49   1          else
  50   1          {
  51   2              // IIC_Start();
  52   2              // IIC_WR_Byte(0x78); //salave address SA0=0
  53   2          //    SCL=1;
  54   2          //    SCL=0;
C51 COMPILER V9.56.0.0   OLED                                                              04/06/2018 12:37:06 PAGE 2   

  55   2              // IIC_WR_Byte(0x00);
  56   2          //    SCL=1;
  57   2          //    SCL=0;
  58   2              // IIC_WR_Byte(Data);
  59   2          //    SCL=1;
  60   2          //    SCL=0;
  61   2              // IIC_Stop();
  62   2          OBIIC_Start();
  63   2          OBIIC_SendData(0x78);
  64   2          OBIIC_RecvACK();
  65   2          OBIIC_SendData(0x00);
  66   2          OBIIC_RecvACK();
  67   2          OBIIC_SendData(Data);
  68   2          OBIIC_RecvACK();
  69   2          OBIIC_Stop();
  70   2          }
  71   1      
  72   1      }
  73          
  74          void OLED_Set_Pos(unsigned char x,unsigned char y)
  75          {
  76   1          OLED_WR_Byte(0xb0+y,OLED_CMD);
  77   1          OLED_WR_Byte(((x&0xf0)>>4)|0x10,OLED_CMD);
  78   1          OLED_WR_Byte((x&0x0f),OLED_CMD);
  79   1      }
  80          
  81          void OLED_Display_ON()
  82          {
  83   1          OLED_WR_Byte(0x8d,OLED_CMD);
  84   1          OLED_WR_Byte(0x14,OLED_CMD);
  85   1          OLED_WR_Byte(0xaf,OLED_CMD);
  86   1      }
  87          
  88          void OLED_Display_OFF()
  89          {
  90   1          OLED_WR_Byte(0x80,OLED_CMD);
  91   1          OLED_WR_Byte(0x10,OLED_CMD);
  92   1          OLED_WR_Byte(0xae,OLED_CMD);
  93   1      }
  94          
  95          //void OLED_Clear()
  96          //{
  97          //    unsigned char i,n;
  98          //    for(i=0;i<8;i++)  
  99          //  {  
 100          //    OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
 101          //    OLED_WR_Byte (0x00,OLED_CMD);      //设置显示位置―列低地址
 102          //    OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址   
 103          //    for(n=0;n<128;n++)OLED_WR_Byte(0,OLED_DATA); 
 104          //  }
 105          //}
 106          void OLED_Clear()
 107          {
 108   1          unsigned char i,n;
 109   1          for(i=0;i<128;i++)  
 110   1        {  
 111   2      //    OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
 112   2      //    OLED_WR_Byte (0x00,OLED_CMD);      //设置显示位置―列低地址
 113   2      //    OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址   
 114   2          for(n=0;n<8;n++)OLED_WR_Byte(0,OLED_DATA); 
 115   2        }
 116   1      }
C51 COMPILER V9.56.0.0   OLED                                                              04/06/2018 12:37:06 PAGE 3   

 117          //初始化SSD1306             
 118          void OLED_Init(void)
 119          {   
 120   1          delay();
 121   1          OLED_WR_Byte(0xAE,OLED_CMD);//关闭显示
 122   1        
 123   1        OLED_WR_Byte(0x40,OLED_CMD);//---set low column address
 124   1        OLED_WR_Byte(0xB0,OLED_CMD);//---set high column address
 125   1      
 126   1        OLED_WR_Byte(0xC8,OLED_CMD);//-not offset
 127   1      
 128   1        OLED_WR_Byte(0x81,OLED_CMD);//设置对比度
 129   1        OLED_WR_Byte(0xff,OLED_CMD);
 130   1      
 131   1        OLED_WR_Byte(0xa1,OLED_CMD);//段重定向设置
 132   1      
 133   1        OLED_WR_Byte(0xa6,OLED_CMD);//
 134   1        
 135   1        OLED_WR_Byte(0xa8,OLED_CMD);//设置驱动路数
 136   1        OLED_WR_Byte(0x1f,OLED_CMD);
 137   1        
 138   1        OLED_WR_Byte(0xd3,OLED_CMD);
 139   1        OLED_WR_Byte(0x00,OLED_CMD);
 140   1        
 141   1        OLED_WR_Byte(0xd5,OLED_CMD);
 142   1        OLED_WR_Byte(0xf0,OLED_CMD);
 143   1        
 144   1        OLED_WR_Byte(0xd9,OLED_CMD);
 145   1        OLED_WR_Byte(0x22,OLED_CMD);
 146   1        
 147   1        OLED_WR_Byte(0xda,OLED_CMD);
 148   1        OLED_WR_Byte(0x02,OLED_CMD);
 149   1        
 150   1        OLED_WR_Byte(0xdb,OLED_CMD);
 151   1        OLED_WR_Byte(0x49,OLED_CMD);
 152   1        
 153   1        OLED_WR_Byte(0x8d,OLED_CMD);
 154   1        OLED_WR_Byte(0x14,OLED_CMD);
 155   1        
 156   1        OLED_WR_Byte(0x20,OLED_CMD);//
 157   1        OLED_WR_Byte(0x21,OLED_CMD);
 158   1        
 159   1        OLED_WR_Byte(0xaf,OLED_CMD);
 160   1        OLED_Clear();
 161   1      }  
 162          
 163          void OLED_DrawBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char* BMP
             -)
 164          {   
 165   1       unsigned int j=0;
 166   1       unsigned char x,y;
 167   1        
 168   1        if(y1%8==0) y=y1/8;      
 169   1        else y=y1/8+1;
 170   1        for(y=y0;y<y1;y++)
 171   1        {
 172   2          OLED_Set_Pos(x0,y);
 173   2          for(x=x0;x<x1;x++)
 174   2            {      
 175   3              OLED_WR_Byte(*BMP,OLED_DATA);
 176   3              BMP++;
 177   3            }
C51 COMPILER V9.56.0.0   OLED                                                              04/06/2018 12:37:06 PAGE 4   

 178   2        }
 179   1      } 
 180          //void OLED_Draw(unsigned char x,unsigned char y,unsigned int Length,unsigned int width,unsigned char* BMP
             -)
 181          //{
 182          //  unsigned int i,h;
 183          //  //OLED_Set_Pos(x,y);
 184          //  for(i=0;i<width;i++)
 185          //  {
 186          //    OLED_Set_Pos(x,y+i);
 187          //    for(h=0;h<Length;h++)
 188          //    {
 189          //      OLED_WR_Byte(*BMP,OLED_DATA);
 190          //      BMP++;
 191          //    }
 192          //    
 193          //  }
 194          //}
 195          void OLED_Draw(unsigned char x,unsigned char y,unsigned int Length,unsigned int width,unsigned char* BMP)
 196          {
 197   1        unsigned int i,h;
 198   1        //OLED_Set_Pos(x,y);
 199   1        for(i=0;i<Length;i++)
 200   1        {
 201   2          OLED_Set_Pos(x+i,y);
 202   2          for(h=0;h<width;h++)
 203   2          {
 204   3            OLED_WR_Byte(*BMP,OLED_DATA);
 205   3            BMP++;
 206   3          }
 207   2          
 208   2        }
 209   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    808    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      20
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
