C51 COMPILER V9.56.0.0   IIC                                                               04/13/2018 18:15:52 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN \\192.168.2.201\Users\zhongzuan\IIC.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE ..\Lib\src\IIC.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\
                    -Lib;..\Lib\inc;..\Lib\src;..\sourses) DEBUG OBJECTEXTEND PRINT(.\Listings\IIC.lst) TABS(2) OBJECT(\\192.168.2.201\Users\
                    -zhongzuan\IIC.obj)

line level    source

   1          #include "IIC.h"
   2          
   3          void IIC_Start()
   4          {
   5   1          SCL=1;
   6   1          SDA=1;
   7   1          SDA=0;
   8   1          SCL=0;
   9   1      }
  10          void IIC_Stop()
  11          {
  12   1          SCL=1;
  13   1          SDA=0;
  14   1          SDA=1;
  15   1      }
  16          
  17          void IIC_WR_Byte(unsigned char IIC_Byte)
  18          {
  19   1          unsigned char a=0;
  20   1          for(a=0;a<8;a++)
  21   1          {
  22   2              SDA=IIC_Byte>>7;
  23   2              IIC_Byte=IIC_Byte<<1;
  24   2              Delay5us();
  25   2              SCL=1;
  26   2              Delay5us();
  27   2              SCL=0;
  28   2              Delay5us();
  29   2          }
  30   1          SDA=1;
  31   1          SCL=1;
  32   1      
  33   1      }
  34          //void IIC_Wait_Ack()
  35          //{
  36              
  37          //    SCL=1;
  38          //    SCL=0;
  39          //}
  40          void IIC_Wait_Ack()
  41          {
  42   1          unsigned char b;
  43   1          while(SDA)
  44   1          {
  45   2              b++;
  46   2              if(b>30)
  47   2              {
  48   3                  SCL=0;
  49   3              
  50   3              }
  51   2          }
  52   1      }
  53          void IIC_Nack()
C51 COMPILER V9.56.0.0   IIC                                                               04/13/2018 18:15:52 PAGE 2   

  54          {
  55   1          SCL=0;
  56   1          SDA=1;
  57   1          SCL=1;
  58   1          Delay5us();
  59   1          SCL=0;
  60   1          Delay5us();
  61   1      }
  62          unsigned char IIC_rcvbyte_nack()
  63          {
  64   1          unsigned char a,dat;
  65   1          SDA=1;
  66   1          Delay5us(); 
  67   1          for(a=0;a<8;a++)
  68   1          {
  69   2              SCL=1;
  70   2              Delay5us();
  71   2              dat<<=1;
  72   2              dat|=SDA;
  73   2              Delay5us();
  74   2              SCL=0;
  75   2              Delay5us();
  76   2      
  77   2          }
  78   1      
  79   1          //给出NACK信号
  80   1         //IIC_Nack();
  81   1       //   _nop_();
  82   1       //   _nop_();
  83   1        //  SCL=0;
  84   1         // _nop_();
  85   1       //   _nop_();
  86   1        //  SDA=1;
  87   1         // _nop_();
  88   1          //_nop_();
  89   1         // SCL=1;
  90   1        //  _nop_();
  91   1         // _nop_();
  92   1         // SCL=0;
  93   1        //  _nop_();
  94   1         // _nop_();
  95   1          return dat;
  96   1      }
  97          unsigned char IIC_rcvbyte_ack()
  98          {
  99   1          unsigned char retc;
 100   1          unsigned char bitcnt;
 101   1          retc=0;
 102   1          SDA=1;
 103   1          for(bitcnt=0;bitcnt<8;bitcnt++)
 104   1          {
 105   2              _nop_();
 106   2              _nop_();
 107   2              SCL=0;
 108   2              _nop_();
 109   2              _nop_();
 110   2              SCL=1;
 111   2              _nop_();
 112   2              _nop_();
 113   2              retc=retc<<1;
 114   2              if(SDA==1)
 115   2              retc=retc+1;
C51 COMPILER V9.56.0.0   IIC                                                               04/13/2018 18:15:52 PAGE 3   

 116   2              _nop_();
 117   2              _nop_();
 118   2          }
 119   1          //给出ACK信号
 120   1          _nop_();
 121   1          _nop_();
 122   1          SCL=0;
 123   1          _nop_();
 124   1          _nop_();
 125   1          SDA=0;
 126   1          _nop_();
 127   1          _nop_();
 128   1          SCL=1;
 129   1          _nop_();
 130   1          _nop_();
 131   1          SCL=0;
 132   1          _nop_();
 133   1          _nop_();
 134   1          return(retc);
 135   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    192    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
