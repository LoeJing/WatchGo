C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 14:46:35 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN \\192.168.2.201\Users\zhongzuan\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Lib;..\Lib
                    -\inc;..\Lib\src;..\sourses) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(\\192.168.2.201\Users\zhongzuan
                    -\main.obj)

line level    source

   1          #include "common.h"
   2          #include "oled.h"
   3          
   4          #include "Display.h"
   5          #include "Timer.h"
   6          #include "Uart.h"
   7          #include "MAX30100.h"
   8          #include "MSTP.h"
   9          
  10          #define DEBUG
  11          //#include "Power.h"
  12          
  13          unsigned char xdata SMode=0;
  14          
  15          enum FucState
  16          {
  17            TimeMode=1,
  18            HeartRateMode,
  19            StepMode
  20          };
  21          
  22          void main()
  23          {
  24   1        pack tmpPack;
  25   1        unsigned char tmpCnt[6]=0;
  26   1        unsigned char ID=0 ;
  27   1      
  28   1        P_SW2=0xb0;
  29   1        I2CCFG=0xe0;
  30   1        I2CMSST=0x00;
  31   1      
  32   1        // MAX30100_startTemperatureSampling();
  33   1        
  34   1        //  powerInit();
  35   1      
  36   1        Timer0Init();
  37   1        SMode=TimeMode;
  38   1      
  39   1        MAX30100_writeRegister(0x06,0x0b);
  40   1        MAX30100_writeRegister(0x01,0xf0);
  41   1        MAX30100_writeRegister(0x09,0x33);
  42   1        
  43   1        Uart2Init();
  44   1        Timer0Init();
  45   1      
  46   1        OLED_Init();
  47   1      
  48   1        displayHoursH(0);
  49   1        displayColon(0xff);
  50   1        displayMinuteH(0);
  51   1        displayIcon_Battery(2,0xff);
  52   1        displayIcon_Bluetooth(0x00);
  53   1      
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 14:46:35 PAGE 2   

  54   1        Uart2_SendStr("Started!\n");
  55   1        
  56   1      
  57   1      
  58   1      
  59   1        while(1)
  60   1        {
  61   2      
  62   2      
  63   2          while(SMode==TimeMode)
  64   2          {
  65   3            // if(Rptr!=Wptr)
  66   3            // {
  67   3            //  Uart2SendChar(buffer[Rptr++]);
  68   3            //  Rptr&=0x09;
  69   3            // }
  70   3            
  71   3      
  72   3            if(bDataComplete)
  73   3            {
  74   4              bDataComplete=0;
  75   4              #ifdef DEBUG
  76   4              sendPack(&buffer[0]);
  77   4              #endif
  78   4              if(CheckPack(buffer))
  79   4              {
  80   5                switch(buffer[0])
  81   5                {
  82   6                  case 0x00 : switch(buffer[2])
  83   6                          {
  84   7                            case 0x02:  SMode=HeartRateMode;displayHRmodeIcon(); break;
  85   7                            
  86   7                            default : break;
  87   7                          } break;
  88   6                  case 0x01 : switch(buffer[2])
  89   6                        {
  90   7                          case 0x02 : break;
  91   7                          default : break;
  92   7                        }break;
  93   6                  default : break;
  94   6                }
  95   5                clearBuffer(&buffer[0]);
  96   5      
  97   5              }
  98   4      
  99   4      
 100   4            }
 101   3              
 102   3            if(isSecondChange)
 103   3            {
 104   4              displayColon(0x00);
 105   4            
 106   4              isSecondChange=0;
 107   4            }
 108   3      
 109   3            if(TickCount==25) displayColon(0xff);
 110   3      
 111   3            if(isMinuteChange)
 112   3            {
 113   4              displayMinuteL(Minute%10);
 114   4              if((Minute/10)!=preMinuteH)
 115   4              { 
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 14:46:35 PAGE 3   

 116   5                preMinuteH=Minute/10;
 117   5                displayMinuteH(preMinuteH);
 118   5                
 119   5              }
 120   4              isMinuteChange=0;
 121   4      
 122   4            }
 123   3            if(isHourChange)
 124   3            {
 125   4              displayHoursL(Hour%10);
 126   4              if((Hour/10)!=preHourH) 
 127   4              {
 128   5                preHourH=Hour/10;
 129   5                displayHoursH(preHourH);
 130   5              }
 131   4              isHourChange=0;
 132   4            }
 133   3      
 134   3      
 135   3          
 136   3        //  getBatteryState();
 137   3        //  displayIcon_Battery(4,0xff);
 138   3          
 139   3        
 140   3          }
 141   2      
 142   2          while(SMode==HeartRateMode)
 143   2          {
 144   3            
 145   3            if(bDataComplete)
 146   3            {
 147   4              bDataComplete=0;
 148   4              if(CheckPack(buffer))
 149   4              {
 150   5                switch(buffer[0])
 151   5                {
 152   6                  case 0x00 : switch(buffer[2])
 153   6                          {
 154   7                            case 0x02:  SMode=TimeMode;OLED_Clear(); break;
 155   7                            case 0x03:  
 156   7                                  tmpCnt[0]=MAX30100_getPartID();
 157   7                                  tmpPack.type=0x01;tmpPack.cmd=0x03;tmpPack.cnt=tmpCnt;tmpPack.length=1;
 158   7                                  doPack(tmpPack,buffer);
 159   7                                  sendPack(buffer);
 160   7                                  break;
 161   7                            default : break;
 162   7                          } break;
 163   6                  case 0x01 : switch(buffer[2])
 164   6                        {
 165   7                          case 0x02 : break;
 166   7                          default : break;
 167   7                        }break;
 168   6                  default : break;
 169   6                }
 170   5                clearBuffer(&buffer[0]);
 171   5      
 172   5              }
 173   4      
 174   4      
 175   4            }
 176   3          
 177   3      
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 14:46:35 PAGE 4   

 178   3            
 179   3          }
 180   2          while(SMode==StepMode)
 181   2          {
 182   3      
 183   3      
 184   3          }
 185   2      
 186   2      
 187   2        }
 188   1      
 189   1      
 190   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    505    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =      1    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
