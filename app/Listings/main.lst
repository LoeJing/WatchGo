C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 22:23:47 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN \\192.168.2.201\Users\zhongzuan\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Lib;..\Lib
                    -\inc;..\Lib\src;..\sourses) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(\\192.168.2.201\Users\zhongzuan
                    -\main.obj)

line level    source

   1          #include "common.h"
   2          #include "oled.h"
   3          
   4          #include "Display.h"
   5          #include "Timer.h"
   6          #include "Uart.h"
   7          #include "MAX30100.h"
   8          #include "MSTP.h"
   9          
  10          #define refreashDisplay()  preHourH=Hour/10;preMinuteH=Minute/10; displayHoursH(preHourH);displayHoursL(Ho
             -ur%10);displayMinuteH(preMinuteH);displayMinuteL(Minute%10);\
  11                        displayIcon_Battery(2,0xff);displayIcon_Bluetooth(0x00)
  12          
  13          
  14          #define DEBUG
  15          //#include "Power.h"
  16          
  17          unsigned char xdata SMode=0;
  18          
  19          enum FucState
  20          {
  21            TimeMode=1,
  22            HeartRateMode,
  23            StepMode
  24          };
  25          
  26          void main()
  27          {
  28   1        pack tmpPack;
  29   1        unsigned char tmpCnt[6]=0;
  30   1        unsigned char ID=0 ;
  31   1      
  32   1        P_SW2=0xb0;
  33   1        I2CCFG=0xe0;
  34   1        I2CMSST=0x00;
  35   1      
  36   1        // MAX30100_startTemperatureSampling();
  37   1        
  38   1        //  powerInit();
  39   1      
  40   1        Timer0Init();
  41   1        SMode=TimeMode;
  42   1      
  43   1        MAX30100_writeRegister(0x06,0x0b);
  44   1        MAX30100_writeRegister(0x01,0xf0);
  45   1        MAX30100_writeRegister(0x09,0x33);
  46   1        
  47   1        Uart2Init();
  48   1        Timer0Init();
  49   1      
  50   1        OLED_Init();
  51   1      
  52   1        displayHoursH(0);
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 22:23:47 PAGE 2   

  53   1        displayColon(0xff);
  54   1        displayMinuteH(0);
  55   1        displayIcon_Battery(2,0xff);
  56   1        displayIcon_Bluetooth(0x00);
  57   1      
  58   1        Uart2_SendStr("Started!\n");
  59   1        
  60   1      
  61   1      
  62   1      
  63   1        while(1)
  64   1        {
  65   2      
  66   2      
  67   2          while(SMode==TimeMode)
  68   2          {
  69   3            // if(Rptr!=Wptr)
  70   3            // {
  71   3            //  Uart2SendChar(buffer[Rptr++]);
  72   3            //  Rptr&=0x09;
  73   3            // }
  74   3            
  75   3      
  76   3            if(bDataComplete)
  77   3            {
  78   4              bDataComplete=0;
  79   4      
  80   4              if(CheckPack(buffer))   //CheckPack(buffer)
  81   4              {
  82   5                #ifdef DEBUG
  83   5                sendPack(&buffer[0]);
  84   5                #endif
  85   5                switch(buffer[0])
  86   5                {
  87   6                  case 0x00 : switch(buffer[2])
  88   6                          {
  89   7                            case 0x02:  SMode=HeartRateMode;displayHRmodeIcon(); break;
  90   7                            case 0x03:  Hour=buffer[3]; Minute=buffer[4];Second=buffer[5];
  91   7                                  refreashDisplay();
  92   7                                  break;
  93   7                            
  94   7                            default : break;
  95   7                          } break;
  96   6                  case 0x01 : switch(buffer[2])
  97   6                        {
  98   7                          case 0x02 : break;
  99   7                          default : break;
 100   7                        }break;
 101   6                  default : break;
 102   6                }
 103   5                clearBuffer(&buffer[0]);
 104   5      
 105   5              }
 106   4      
 107   4      
 108   4            }
 109   3              
 110   3            if(isSecondChange)
 111   3            {
 112   4              displayColon(0x00);
 113   4            
 114   4              isSecondChange=0;
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 22:23:47 PAGE 3   

 115   4            }
 116   3      
 117   3            if(TickCount==25) displayColon(0xff);
 118   3      
 119   3            if(isMinuteChange)
 120   3            {
 121   4              displayMinuteL(Minute%10);
 122   4              if((Minute/10)!=preMinuteH)
 123   4              { 
 124   5                preMinuteH=Minute/10;
 125   5                displayMinuteH(preMinuteH);
 126   5                
 127   5              }
 128   4              isMinuteChange=0;
 129   4      
 130   4            }
 131   3            if(isHourChange)
 132   3            {
 133   4              displayHoursL(Hour%10);
 134   4              if((Hour/10)!=preHourH) 
 135   4              {
 136   5                preHourH=Hour/10;
 137   5                displayHoursH(preHourH);
 138   5              }
 139   4              isHourChange=0;
 140   4            }
 141   3      
 142   3      
 143   3          
 144   3        //  getBatteryState();
 145   3        //  displayIcon_Battery(4,0xff);
 146   3          
 147   3        
 148   3          }
 149   2      
 150   2          while(SMode==HeartRateMode)
 151   2          {
 152   3            
 153   3            if(bDataComplete)
 154   3            {
 155   4              bDataComplete=0;
 156   4              if(CheckPack(buffer))
 157   4              {
 158   5                switch(buffer[0])
 159   5                {
 160   6                  case 0x00 : switch(buffer[2])
 161   6                          {
 162   7                            case 0x02:  SMode=TimeMode;OLED_Clear(); 
 163   7                                  refreashDisplay();
 164   7                            
 165   7                                  break;
 166   7                            case 0x03:  
 167   7                                  tmpCnt[0]=MAX30100_getPartID();
 168   7                                  tmpPack.type=0x01;tmpPack.cmd=0x03;tmpPack.cnt=tmpCnt;tmpPack.length=1;
 169   7                                  doPack(tmpPack,buffer);
 170   7                                  sendPack(buffer);
 171   7                                  break;
 172   7                            
 173   7                            default : break;
 174   7                          } break;
 175   6                  case 0x01 : switch(buffer[2])
 176   6                        {
C51 COMPILER V9.56.0.0   MAIN                                                              04/22/2018 22:23:47 PAGE 4   

 177   7                          case 0x02 : break;
 178   7                          default : break;
 179   7                        }break;
 180   6                  default : break;
 181   6                }
 182   5                clearBuffer(&buffer[0]);
 183   5      
 184   5              }
 185   4      
 186   4      
 187   4            }
 188   3          
 189   3      
 190   3            
 191   3          }
 192   2          while(SMode==StepMode)
 193   2          {
 194   3      
 195   3      
 196   3          }
 197   2      
 198   2      
 199   2        }
 200   1      
 201   1      
 202   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    802    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =      1    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
